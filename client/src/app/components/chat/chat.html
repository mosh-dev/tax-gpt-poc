<div class="chat-container">
  <!-- Header -->
  <div class="chat-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo-icon">
          ğŸ‡¨ğŸ‡­
        </div>
        <h2 class="header-title">Tax-GPT Assistant</h2>
      </div>
      <button
        (click)="clearChat()"
        class="clear-btn">
        Clear Chat
      </button>
    </div>
  </div>

  <!-- Messages Container -->
  <div class="messages-container">
    <div *ngFor="let message of messages" class="message-wrapper" [class.user-message]="message.role === 'user'" [class.assistant-message]="message.role === 'assistant'">
      <div class="message-bubble" [class.user-bubble]="message.role === 'user'" [class.assistant-bubble]="message.role === 'assistant'">
        <div class="message-sender">
          {{ message.role === 'user' ? 'You' : 'Assistant' }}
        </div>
        <div class="message-content" [innerHTML]="parseMarkdownLinks(message.content)">
        </div>
        <div class="message-timestamp">
          {{ message.timestamp | date:'short' }}
        </div>
      </div>
    </div>

    <div *ngIf="isLoading" class="message-wrapper assistant-message">
      <div class="message-bubble assistant-bubble">
        <div class="message-sender">
          Assistant
        </div>
        <div class="loading-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Container (Sticky) -->
  <div class="input-container">
    <!-- Error Message -->
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>

    <!-- Input Section -->
    <div class="input-section">
      <textarea
        [(ngModel)]="currentMessage"
        (keypress)="onKeyPress($event)"
        placeholder="Ask me about your Swiss tax return..."
        [disabled]="isLoading"
        rows="3"
        class="message-input"></textarea>
      <button
        (click)="sendMessage()"
        [disabled]="!currentMessage.trim() || isLoading"
        class="send-btn">
        Send
      </button>
    </div>
  </div>

  <!-- Tax Data Confirmation Modal -->
  <app-tax-data-modal
    [isOpen]="isModalOpen"
    [taxData]="pendingTaxData"
    [scenario]="pendingScenario"
    (confirm)="onConfirmTaxData()"
    (cancel)="onCancelTaxData()">
  </app-tax-data-modal>
</div>
