<div class="chat-container">
  <div class="chat-header">
    <h2>Tax-GPT Assistant</h2>
    <button class="clear-btn" (click)="clearChat()">Clear Chat</button>
  </div>

  <!-- Tax Scenario Selector -->
  <div class="scenario-selector">
    <div class="selector-content">
      <label for="scenario">Load Mock Tax Data:</label>
      <select id="scenario" [(ngModel)]="selectedScenario" [disabled]="isLoadingScenario">
        <option value="">Select a scenario...</option>
        <option *ngFor="let scenario of availableScenarios" [value]="scenario.id">
          {{ scenario.name }} (CHF {{ scenario.income | number }})
        </option>
      </select>
      <button
        (click)="loadScenario()"
        [disabled]="!selectedScenario || isLoadingScenario"
        class="load-btn">
        {{ isLoadingScenario ? 'Loading...' : 'Load Data' }}
      </button>
      <span *ngIf="loadedTaxData" class="loaded-indicator">âœ“ Data Loaded</span>
    </div>
  </div>

  <div class="messages-container">
    <div *ngFor="let message of messages"
         [class]="'message message-' + message.role">
      <div class="message-content">
        <div class="message-role">{{ message.role === 'user' ? 'You' : 'Assistant' }}</div>
        <div class="message-text">{{ message.content }}</div>
        <div class="message-time">{{ message.timestamp | date:'short' }}</div>
      </div>
    </div>

    <div *ngIf="isLoading" class="message message-assistant">
      <div class="message-content">
        <div class="message-role">Assistant</div>
        <div class="message-text typing-indicator">
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <div class="input-container">
    <textarea
      [(ngModel)]="currentMessage"
      (keypress)="onKeyPress($event)"
      placeholder="Ask me about your Swiss tax return..."
      [disabled]="isLoading"
      rows="3"></textarea>
    <button
      (click)="sendMessage()"
      [disabled]="!currentMessage.trim() || isLoading">
      Send
    </button>
  </div>
</div>
